<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>Sortownia: Tutorial Statystyki Bayesowskiej</title>

<meta property="description" itemprop="description" content="Część IV: Wprowadzenie do modeli wielopoziomowych"/>


<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2022-10-30"/>
<meta property="article:created" itemprop="dateCreated" content="2022-10-30"/>
<meta name="article:author" content="Szymon Mąka"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Sortownia: Tutorial Statystyki Bayesowskiej"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Część IV: Wprowadzenie do modeli wielopoziomowych"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Sortownia"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary"/>
<meta property="twitter:title" content="Sortownia: Tutorial Statystyki Bayesowskiej"/>
<meta property="twitter:description" content="Część IV: Wprowadzenie do modeli wielopoziomowych"/>

<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Why we (usually) don’t have to worry about multiple comparisons;citation_publisher=Taylor &amp; Francis;citation_volume=5;citation_author=Andrew Gelman;citation_author=Jennifer Hill;citation_author=Masanao Yajima"/>
  <meta name="citation_reference" content="citation_title=Data analysis using regression and multilevel/hierarchical models;citation_publisher=Cambridge university press;citation_author=Andrew Gelman;citation_author=Jennifer Hill"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","preview","author","date","output","bibliography","categories","csl"]}},"value":[{"type":"character","attributes":{},"value":["Tutorial Statystyki Bayesowskiej"]},{"type":"character","attributes":{},"value":["Część IV: Wprowadzenie do modeli wielopoziomowych"]},{"type":"character","attributes":{},"value":["Statystyczne_Dygresje2.jpg"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Szymon Mąka"]},{"type":"character","attributes":{},"value":["https://revan-tech.github.io/kontakt.html"]}]}]},{"type":"character","attributes":{},"value":["10-30-2022"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","includes","css"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["in_header"]}},"value":[{"type":"character","attributes":{},"value":["hero-image.html"]}]},{"type":"character","attributes":{},"value":["theme.css"]}]}]},{"type":"character","attributes":{},"value":["bib.bib"]},{"type":"character","attributes":{},"value":["Statystyczne Dygresje"]},{"type":"character","attributes":{},"value":["apa.csl"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["apa.csl","bib.bib","cty.dat","hero-image.html","MBM Data/Radon_Data.csv","MBM Data/Restaurant_data.csv","model.jpg","radon.data","Radon_Data.csv","rsquared.bug","srrs2.dat","Statystyczne_Dygresje.jpg","Statystyczne_Dygresje2.jpg","theme.css","tutorial-bayes-iv_files/anchor-4.2.2/anchor.min.js","tutorial-bayes-iv_files/bowser-1.9.3/bowser.min.js","tutorial-bayes-iv_files/distill-2.2.21/template.v2.js","tutorial-bayes-iv_files/figure-html5/unnamed-chunk-2-1.png","tutorial-bayes-iv_files/figure-html5/unnamed-chunk-3-1.png","tutorial-bayes-iv_files/figure-html5/unnamed-chunk-4-1.png","tutorial-bayes-iv_files/figure-html5/unnamed-chunk-5-1.png","tutorial-bayes-iv_files/header-attrs-2.10/header-attrs.js","tutorial-bayes-iv_files/header-attrs-2.21/header-attrs.js","tutorial-bayes-iv_files/jquery-1.11.3/jquery.min.js","tutorial-bayes-iv_files/jquery-3.6.0/jquery-3.6.0.js","tutorial-bayes-iv_files/jquery-3.6.0/jquery-3.6.0.min.js","tutorial-bayes-iv_files/jquery-3.6.0/jquery-3.6.0.min.map","tutorial-bayes-iv_files/popper-2.6.0/popper.min.js","tutorial-bayes-iv_files/tippy-6.2.7/tippy-bundle.umd.min.js","tutorial-bayes-iv_files/tippy-6.2.7/tippy-light-border.css","tutorial-bayes-iv_files/tippy-6.2.7/tippy.css","tutorial-bayes-iv_files/tippy-6.2.7/tippy.umd.min.js","tutorial-bayes-iv_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.4.0/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.21/header-attrs.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<link rel="icon" type="image/png" href="favicon.ico"/>
<!--/radix_placeholder_site_in_header-->
  <div class="hero-image"> 

  </div>

  <link rel="stylesheet" href="theme.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Tutorial Statystyki Bayesowskiej","description":"Część IV: Wprowadzenie do modeli wielopoziomowych","authors":[{"author":"Szymon Mąka","authorURL":"https://revan-tech.github.io/kontakt.html","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2022-10-30T00:00:00.000+02:00","citationText":"Mąka, 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">Sortownia</a>
<a href="../../index.html">Home</a>
<a href="../../blog.html">Blog</a>
<a href="../../poradniki.html">Poradniki</a>
<a href="https://szpm.shinyapps.io/baza_wiedzy/">Baza wiedzy</a>
<a href="../../projekty.html">Projekty</a>
<a href="../../statystyczne_dygresje.html">Statystyczne Dygresje</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../kontakt.html">Kontakt</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Tutorial Statystyki Bayesowskiej</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>Część IV: Wprowadzenie do modeli wielopoziomowych</p></p>
</div>

<div class="d-byline">
  Szymon Mąka <a href="https://revan-tech.github.io/kontakt.html" class="uri">https://revan-tech.github.io/kontakt.html</a> 
  
<br/>10-30-2022
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#motywacja" id="toc-motywacja">Motywacja</a>
<ul>
<li><a href="#niewykrycie-prawdziego-efektu" id="toc-niewykrycie-prawdziego-efektu">Niewykrycie prawdziego efektu</a></li>
<li><a href="#wykrycie-nieprawdziwego-efektu" id="toc-wykrycie-nieprawdziwego-efektu">Wykrycie nieprawdziwego efektu</a></li>
<li><a href="#z-czym-się-mierzymy" id="toc-z-czym-się-mierzymy">Z czym się mierzymy?</a></li>
<li><a href="#czym-jest-więc-model-mieszany" id="toc-czym-jest-więc-model-mieszany">Czym jest więc model mieszany?</a></li>
</ul></li>
<li><a href="#modele-wielopoziomowe" id="toc-modele-wielopoziomowe">Modele wielopoziomowe</a>
<ul>
<li><a href="#model-z-efektem-klastra" id="toc-model-z-efektem-klastra">Model z efektem klastra</a></li>
<li><a href="#implementacja" id="toc-implementacja">Implementacja</a></li>
<li><a href="#niezależność-warunkowa" id="toc-niezależność-warunkowa">Niezależność warunkowa</a></li>
</ul></li>
<li><a href="#bayesowskie-dzielenie-informacji" id="toc-bayesowskie-dzielenie-informacji">Bayesowskie dzielenie informacji</a></li>
<li><a href="#modelujmy-dalej" id="toc-modelujmy-dalej">Modelujmy dalej</a>
<ul>
<li><a href="#modelowanie-interceptu-i-wpspółczynnika-regresji-dla-klastra" id="toc-modelowanie-interceptu-i-wpspółczynnika-regresji-dla-klastra">Modelowanie interceptu i wpspółczynnika regresji dla klastra</a></li>
<li><a href="#predyktory-na-wyższych-poziomach" id="toc-predyktory-na-wyższych-poziomach">Predyktory na wyższych poziomach</a></li>
</ul></li>
<li><a href="#podsumowanie" id="toc-podsumowanie">Podsumowanie</a></li>
</ul>
</nav>
</div>
<div class="layout-chunk" data-layout="l-body">
<style type="text/css">
.MathJax_Display, .MJXc-display, .MathJax_SVG_Display {
    overflow-x: auto;
    overflow-y: hidden;
}
</style>
</div>
<p style="color:blue">
Post będzie aktualizowany.
</p>
<p>Dzisiaj zajmiemy się bayesowskimi wielopopoziomowymi (mieszanymi/hierarchicznymi) modelami liniowymi. Na ten temat poświęca się całe książki, (choć z drugiej strony czasami mam wrażenie, że traktuje się ten temat jak czarną magię). Zobaczmy o co całe zmieszanie.</p>
<h2 id="motywacja">Motywacja</h2>
<p>Zamiast zaczynać od wprowadzenia definicji mieszanego modelu liniowego, przyjrzyjmy się poniższym sytuacjom.</p>
<h3 id="niewykrycie-prawdziego-efektu">Niewykrycie prawdziego efektu</h3>
<p>Załóżmy, że wykonujemy przez pewien czas pomiary zadowolenia z obsługi i wysokości napiwków u stałych klientów pewnej restauracji.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="tutorial-bayes-iv_files/figure-html5/unnamed-chunk-2-1.png" width="624" /></p>
</div>
<p>Widzimy tu brak zależności liniowej. Teraz zróbmy tak by na wykresie kolor kropki odpowiadał konkretnemu klientowi.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="tutorial-bayes-iv_files/figure-html5/unnamed-chunk-3-1.png" width="624" /></p>
</div>
<p>Widzimy, że u każdego z klientów występuje związek liniowy pomiędzy napiwkiem i zadowoleniem. Jednak ponieważ, nasze pomiary zagnieżdone są w klientach, co objawia się tym, że każdy klient średnio daje inną wartość napiwku, przeoczylibyśmy ten związek, nie uwzględniając tego w modelu.</p>
<h3 id="wykrycie-nieprawdziwego-efektu">Wykrycie nieprawdziwego efektu</h3>
<p>Czy może nam się zdarzyć sytuacja odwrotna? Używając prostej analizy liniowej wykryjemy efekt, którego nie ma? Załóżmy, że chcemy ocenić wpływ picia napojów kofeinowych na wyniki ucznia w nauce. Zebraliśmy dane z trzech klas liceum pytając o średnie spożycie napojów kofeinowych dziennie i średnią ocen.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="tutorial-bayes-iv_files/figure-html5/unnamed-chunk-4-1.png" width="624" /></p>
</div>
<p>Zaznaczmy na wykresie kolorami uczniów przynależących do danej klasy.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="tutorial-bayes-iv_files/figure-html5/unnamed-chunk-5-1.png" width="624" /></p>
</div>
<p>Jak widzimy, w poszególnych klasach spożycie kofeiny nie ma wpływu na wyniki ucznia w nauce. Kiedy możemy zaobserwować taką zależność? Załóżmy na przykład, że każda z klas ma innego wychowawcę i ich wpływ przedkłada się na średnią ocen. Załóżmy też, że zupełnie przypadkowo w klasach z lepszym wychowawcą, średnie spożycie napojów kofeinowych jest większe. Otrzymamy wtedy sytuację jak na powyższych wykresach.</p>
<p>Oczywiście, może istnieć jakaś zależność pomiędzy średnim spożyciem kofeiny na klasę a jej średnią ocen lecz to nie odpowiada na pytanie, które zadaliśmy tzn. o <strong>wpływ kofeiny na osiągnięcia ucznia</strong>. Tutaj warto wprowadzić sobie rozróżnienie między efektem węwnątrzobiektowym i międzyobiektowym. Zrobiłem to w jednym z poprzednich wpisów, można przeczytać tutaj.</p>
<h3 id="z-czym-się-mierzymy">Z czym się mierzymy?</h3>
<p>Problem możemy zdefiniować na kika sposobów. W pierwszej sytuacji chcemy zbadać związek pomiędzy napwkami a zadowoleniem z obsługi. Na przeszkodzie jednak staje nam efekt kienta - każdy klient ma inny bazowy średni napiwek. Klient jest tu zmienną zakłócającą. By poprawnie wyestymować wpływ zadowolenia na napiwki, moglibyśmy kontrolować wpływ poszczególnego klienta. W istocie, na tym z grubsza polega mechanizm działania mieszanych modeli liniowych.</p>
<p>Przyjrzyjmy się teraz problemowi z innej perspektywy. Gdy chcemy zbadać wpływ zmiennej <span class="math inline">\(X\)</span> na Y, na przykład licząc współczynnik korelacji Pearsona, musimy wykonać następujące kroki (książkowo): <strong>Losujemy obserwacje</strong> do naszej próby. Następnie, ponieważ każda obserwacja miała takie samo prawdopobieństwo dostania się do próby, traktujemy te obserwacje jako niezależne zmienne losowe o identycznym rozkładzie (<strong>iid, independent and identically distributed random variables</strong>). Na chłopski rozum, oznacza to, że jeśli stworzymy sobie histogram zmiennej X, otrzymamy z grubsza estymatę rozkładu zmiennej <span class="math inline">\(X\)</span> w populacji. W przypadku powyższych danych, nie jest to prawda. Przyjrzyjmy sie dokładniej tej definicji.</p>
<p>Definicja składa się z dwóch zasadniczych elementów. <strong>Niezależność</strong> oznacza, że obserwacje są niepowiązane (wylosowanie <span class="math inline">\(x_1\)</span> nie mówi nam nic o prawdopobieństwie wylosowania <span class="math inline">\(x_2\)</span>), co często nie jest spełnione w danych pogrupowanych w klastry, ponieważ obserwacje wewnątrz klastra są do siebie bardziej podobne. Innymi słowy obserwacje w klastrze są ze sobą skorelowane.</p>
<p>Drugą częścią definicji jest fakt, że obserwacje zostały <strong>wylosowane z tego samego rozkładu</strong>. Przykładowo, jeśli wykonujemy pojedynczy pomiar zadowolenia u różnych osób odwiedzających restaurację, to możemy powiedzieć, że wszystkie te obserwacje zostały wylosowane z tego samego rozkładu zadowolenia (by być dokładnym, z tego samego rozkładu w danym klastrze, czyli w tej samej restauracji). Jednakże, w praktyce wielokrotnie wykonujemy pomiary zadowolenia u tych samych osób, co oznacza, że zmienna “zadowolenie” ma inny rozkład u klienta A, a inny u klienta B.</p>
<p>By więc poprawnie przeanalizować takie dane, musimy zastosować model mieszany.</p>
<h3 id="czym-jest-więc-model-mieszany">Czym jest więc model mieszany?</h3>
<p>Wikipedia opisuje go tak: Mieszany model liniowy to model statystyczny, który uwzględnia zarówno efekty stałe (<em>fixed effects</em>), jak i losowe (<em>random effects</em>) w celu analizy zgrupowanych (<em>clustered</em>) danych.</p>
<p>Jest to definicja częstościowa, niemniej jednak pewnie każdy, kto miał styczność z modelami mieszanymi, słyszał o efektach stałych i losowych. Bez wchodzenia zbytnio w tę terminologię, efekty stałe są traktowane jako efekty, które mają określoną wartość, którą staramy się oszacować, na przykład wpływ zadowolenia na wysokość napiwku. Efekt losowy to efekt, który jest opisany jakimś rozkładem statystycznym, a my napotykamy na jakąś jego realizację, na przykład hojność danego klienta. Jednak gdy przeprowadzimy kolejne badanie na innych klientach, wciąż estymujemy ten sam związek między zadowoleniem a wysokością napiwku, ale nasi klienci będą mieli inną bazową wartość hojności.</p>
<p>My nie będziemy korzystać z tej terminologii. Według mnie czasami wporowadza ona zamieszanie w rozumieniu tej klasy modeli. Na szczęście mamy na to bardzo dobre uzasadnienie. Przypomnijcie sobie, że w statystyce Bayesowskiej wszystkie parametry traktujemy jako rozkłady statytyczne. Więc rozróżnienie na efekty stałe i losowe nie ma większego sensu, ponieważ w modelach Bayesowskich <strong>wszystkie efekty są losowe</strong>.</p>
<h2 id="modele-wielopoziomowe">Modele wielopoziomowe</h2>
<h3 id="model-z-efektem-klastra">Model z efektem klastra</h3>
<p>Jak więc będzie wyglądał bayesowski model, którym poprawnie możemy przeanalizować dane z powyższych przykładów?</p>
<p>W poprzednich częściach estymowaliśmy regresję liniową. Miała ona miała postać:</p>
<p><span class="math display">\[y_{i} \sim N(\mu = \alpha + \beta * x_i, \sigma)\]</span>
A wszystkie paramtery w tym równaniu miały rozkłady a priori ze zdefiniowanymymi przez nas hiperparametrami (czyli takimi parametrami, które są zdefiniowane arbitralnie, a nie estymowane z danych).</p>
<p>Teraz musimy uwzględnić w modelu różnice pomiędzy obserwacjami wynikajace z przynależności do klastra:</p>
<p><span class="math display">\[y_{i} \sim N(\mu = \beta * x_i + k_j , \sigma)\]</span>
<span class="math display">\[k_{j} \sim N(\alpha, \tau)\]</span>
<span class="math display">\[\alpha \sim U(-10^{3}, 10^{3})\]</span>
<span class="math display">\[ \tau \sim N(10^{-6}, 10^{3}) \]</span>
<span class="math display">\[ \beta \sim N(0, 10^{2}) \]</span>
<span class="math display">\[ \sigma \sim N(10^{-6}, 10^{3}) \]</span>
Żeby dokładnie zrozumieć co się dzieje, spójrzmy na diagram naszego nowego modelu.</p>
<p><img src="model.jpg" /></p>
<p>Żeby zrozumieć mechanizm tego modelu, warto zwizualizować sobie jak jest estymowany (mi to osobiscie pomagało zrozumieć jak działają bayesowskie modele). Przy użyciu MCMC, najpierw losujemy <span class="math inline">\(\alpha\)</span> i <span class="math inline">\(\tau\)</span> z ich rozkładów a priori, a następnie te wartości są używane do wylosowania wartości <span class="math inline">\(k_j\)</span> dla każdego klastra, korzystając z rozkładu normalnego. Na koniec, mając wylosowane także wartości <span class="math inline">\(\beta\)</span> i <span class="math inline">\(\sigma\)</span>, sprawdzamy, jak prawdopodobne jest, że model o takich parametrach wyprodukował zaobserwowane dane <span class="math inline">\(y\)</span>.</p>
<p>Parametr <span class="math inline">\(k_j\)</span>, który występuje w funckcji wiarygodności ma rozkład <em>a priori</em> opisany rozkładem normalnym o średniej <span class="math inline">\(\alpha\)</span> i wariancji <span class="math inline">\(\tau\)</span>, który także jest estymowany z danych, a jego parametry mają własne rozkłady <em>a priori</em>. Reszta modelu pozostaje taka sama jak w przypadku standardowej regresji. Zamiast pojedynczego interceptu, model ma teraz <span class="math inline">\(j\)</span> interceptów, gdzie <span class="math inline">\(j\)</span> to liczba klastrów.</p>
<p>Rozkład <em>a priori</em> <span class="math inline">\(P(k_j|\alpha,\tau)\)</span> określa prawdopodobieństwo wystąpienia intercepta o danej wartości, gdzie <span class="math inline">\(\alpha\)</span> oznacza średni intercept dla całego zbioru danych, a <span class="math inline">\(\tau\)</span> to wariancja interceptów.</p>
<h3 id="implementacja">Implementacja</h3>
<p>Posłużymy się danymi (do pobrania <span style="color:blue"><a href="https://github.com/Revan-tech/fuzzy-octo-waddle/tree/main/MBM%20Data">tutaj</a></span>) z drugiego przykładu i zaimplementujemy model użyciu JAGS.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://mcmc-jags.sourceforge.io'>rjags</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>coda</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Zadowolenie"</span>, <span class='st'>"Klient"</span>, <span class='st'>"Napiwek"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>mod</span> <span class='op'>=</span> <span class='st'>"model {</span></span>
<span><span class='st'>  # Priors</span></span>
<span><span class='st'>  a ~ dunif(-1000, 1000)</span></span>
<span><span class='st'>  b ~ dnorm(0, 100^-2)</span></span>
<span><span class='st'>  sigma ~ dunif(0.000001,1000)</span></span>
<span><span class='st'>  tau ~ dunif(0.000001,1000)</span></span>
<span><span class='st'>  </span></span>
<span><span class='st'>  for (i in 1:5){</span></span>
<span><span class='st'>  k[i] ~ dnorm(a, tau^-2)</span></span>
<span><span class='st'>  }</span></span>
<span><span class='st'>  </span></span>
<span><span class='st'>  # Likelihood</span></span>
<span><span class='st'>  for (i in 1:length(Napiwek)) {</span></span>
<span><span class='st'>    mu[i] &lt;- b * Zadowolenie[i] + k[Klient[i]]</span></span>
<span><span class='st'>    Napiwek[i] ~ dnorm(mu[i], sigma^-2)</span></span>
<span><span class='st'>  }}"</span></span>
<span></span>
<span><span class='va'>params</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"a"</span>,<span class='st'>"b"</span>,<span class='st'>"k"</span>,<span class='st'>"tau"</span>,<span class='st'>"sigma"</span><span class='op'>)</span></span>
<span><span class='va'>n.adapt</span> <span class='op'>=</span> <span class='fl'>100</span></span>
<span><span class='va'>ni</span> <span class='op'>=</span> <span class='fl'>3000</span></span>
<span><span class='va'>nb</span> <span class='op'>=</span> <span class='fl'>6000</span></span>
<span><span class='va'>nt</span> <span class='op'>=</span> <span class='fl'>1</span></span>
<span><span class='va'>nc</span> <span class='op'>=</span> <span class='fl'>6</span></span>
<span><span class='va'>jmod</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/rjags/man/jags.model.html'>jags.model</a></span><span class='op'>(</span>file <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/textconnections.html'>textConnection</a></span><span class='op'>(</span><span class='va'>mod</span><span class='op'>)</span>, data <span class='op'>=</span> <span class='va'>d</span>, n.chains <span class='op'>=</span> <span class='va'>nc</span>, inits <span class='op'>=</span> <span class='cn'>NULL</span>, n.adapt <span class='op'>=</span> <span class='va'>n.adapt</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span><span class='op'>(</span><span class='va'>jmod</span>, n.iter<span class='op'>=</span><span class='va'>ni</span>, by<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span></span>
<span><span class='va'>post</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/rjags/man/coda.samples.html'>coda.samples</a></span><span class='op'>(</span><span class='va'>jmod</span>, <span class='va'>params</span>, n.iter <span class='op'>=</span> <span class='va'>nb</span>, thin <span class='op'>=</span> <span class='va'>nt</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>post</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>
Iterations = 3101:9100
Thinning interval = 1 
Number of chains = 6 
Sample size per chain = 6000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

         Mean       SD  Naive SE Time-series SE
a     16.4276  7.47502 0.0393968      0.0513538
b      0.2775  0.02595 0.0001368      0.0003621
k[1]   6.2390  0.24924 0.0013136      0.0027737
k[2]  11.4987  0.23385 0.0012325      0.0023770
k[3]  16.2972  0.24498 0.0012912      0.0026526
k[4]  21.6231  0.22539 0.0011879      0.0022120
k[5]  26.5584  0.23133 0.0012192      0.0022662
sigma  0.8546  0.06181 0.0003258      0.0003567
tau   12.9778 10.03949 0.0529128      0.1506377

2. Quantiles for each variable:

         2.5%     25%     50%     75%   97.5%
a      2.8152 13.2834 16.4772 19.6714 29.7990
b      0.2268  0.2600  0.2773  0.2949  0.3288
k[1]   5.7534  6.0705  6.2389  6.4056  6.7280
k[2]  11.0377 11.3422 11.4995 11.6549 11.9585
k[3]  15.8181 16.1331 16.2965 16.4602 16.7806
k[4]  21.1819 21.4733 21.6228 21.7736 22.0702
k[5]  26.1047 26.4045 26.5585 26.7123 27.0184
sigma  0.7431  0.8115  0.8508  0.8939  0.9859
tau    5.2479  7.9375 10.4476 14.6048 35.3352</code></pre>
</div>
<p>Jeśli spojrzymy na kwantyle parametru <span class="math inline">\(\beta\)</span> zauważymy, że 0 znajduje się poniżej 2.5% percentyla. Innymi słowy, wykryliśmy efekt pomiędzy napiwkami a zadowoleniem z obsługi.</p>
<p>Zauważmy też, że model moglibysmy zaimplementować w następującej formie:</p>
<p><span class="math display">\[y_{i} \sim N(\mu =\alpha +  \beta * x_i + k_j , \sigma)\]</span>
<span class="math display">\[k_{j} \sim N(0, \tau)\]</span></p>
<p>Otrzymalibyśmy dokłokładnie to samo z tą różnicą, że teraz nie <span class="math inline">\(k_j\)</span> nie byłoby interceptem dla klastra, a wartością o jaką różni się intercept dla klastra od <span class="math inline">\(\alpha\)</span> (czyli, <span class="math inline">\(\alpha\)</span> + <span class="math inline">\(k_j\)</span> byłby intercepem dla klastra <span class="math inline">\(j\)</span>.)</p>
<p>Wspomniałem wyżej, że modele mieszane zasadniczo można interpretować w kategorii kontrolowania zmiennych zakłócających. Policzmy zwykłą regresję (częstościową, ale dotyczy to też bayesowskiego odpowiednika), w której uwzględnimy predyktory kategorialne wskazujące przynależność do klastra.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://broom.tidymodels.org/'>broom</a></span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://generics.r-lib.org/reference/tidy.html'>tidy</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>Napiwek</span> <span class='op'>~</span> <span class='va'>Zadowolenie</span> <span class='op'>+</span> <span class='va'>Klient</span>, <span class='va'>d</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code># A tibble: 6 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)    6.23     0.246       25.3 4.42e-45
2 Zadowolenie    0.278    0.0256      10.8 1.67e-18
3 Klient2        5.26     0.261       20.1 9.36e-37
4 Klient3       10.1      0.260       38.6 1.61e-61
5 Klient4       15.4      0.263       58.6 1.23e-78
6 Klient5       20.3      0.262       77.6 1.84e-90</code></pre>
</div>
<p>Otrzymaliśmy prawie taki sam współczynnik regresji! Różny sposób ujęcia problemu prowadzi do tego samego rozwiązania.</p>
<p>Ot, cała tajemnica modeli mieszanych. W identyczny sposób możemy rozszerzyć model, by uwzględniał różnice we współczynniku regresji pomiędzy klastrami. Bądź zmodyfikować go tak by uwzględniał więcej poziomów i.e. klastry wenątrz klastrów. I taki przykład sobie zrobimy gdy będziemy omawiać case studies, ale najpierw opowiedzmy sobie o właściwościach modeli wielopoziomowych.</p>
<h3 id="niezależność-warunkowa">Niezależność warunkowa</h3>
<p>Łączny rozkład prawdopodobieństwa <em>post priori</em> naszych parametrów to:</p>
<p><span class="math display">\[P(\beta,k_j,\sigma,\alpha,\tau|y) \propto P(y|\beta,k_j,\sigma) P(k_j|\alpha,\tau) P(\beta)P(\alpha)P(\tau)P(\sigma)\]</span></p>
<p>To na co warto zwrócić uwagę, to relacje niezależności.</p>
<style>
p.comment {
-moz-border-radius: 6px;
-webkit-border-radius: 6px;
background-color: #f0f7fb;
background-image: url(css-box-icon-3.png);
background-position: 9px 0px;
background-repeat: no-repeat;
border: solid 1px #3498db;
border-radius: 6px;
line-height: 18px;
overflow: hidden;
padding: 15px 60px;
}

</style>
<p><br></p>
<p class="comment">
<strong>Warunkowa niezależność</strong>
<br>
<br>
Niech <span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span> i <span class="math inline">\(C\)</span> będą zdarzeniami. <span class="math inline">\(A\)</span> i <span class="math inline">\(B\)</span> są warunkowo niezależne jeśli:
<br>
<br>
<span class="math display">\[P(A|B,C)= P(A|C) \]</span>
Ekwiwalentnie
<span class="math display">\[P(A,B|C) = P(A|C)P(B|C)\]</span>
</p>
<p><br></p>
<p>Czyli, jak widzimy na diagramie, bezpośrednio zależne są ze sobą tylko elementy połączone strzałkami. Na przykład <span class="math inline">\(P(y|\beta,k_j,\sigma)\)</span> nie zależy bezpośrednio od <span class="math inline">\(P(\alpha)\)</span> ponieważ:</p>
<p><span class="math display">\[P(y|\beta,k_j,\sigma,\alpha) = P(y|\beta,k_j,\sigma)\]</span>
Innymi słowy, cała informacja jaką <span class="math inline">\(\alpha\)</span> ma o prawdopodobieństwie <span class="math inline">\(y\)</span>, jest już zawarta w <span class="math inline">\(k_j\)</span>.</p>
<p>Możemy zadać sobie pytanie, skoro ta klasa modeli nazywana jest (też) modelami wielopoziomowymi, to gdzie te poziomy. Jeśli mamy funkcję wiargodności i rozkłady <em>a priori</em> dla parametrów, które zarządzane sa przez wybrane przez badacza wartości hiperparametrów, to modelujemy dane na 1 poziomie. Jeśli jednak parametry rozkładów <em>a priori</em> same mają rozkłady <em>a priori</em> wtedy modelujemy dane na 2 (lub więcej) poziomach.</p>
<h2 id="bayesowskie-dzielenie-informacji">Bayesowskie dzielenie informacji</h2>
<p>Rozważmy teraz następujący problem: zmierzyliśmy zmienną <span class="math inline">\(X\)</span> w różnych podgrupach, a jedyne, co nas interesuje, to średnia wartość zmiennej <span class="math inline">\(X\)</span> w danej podgrupie. Jednak podgrupy różnią się liczebnością. Mamy trzy możliwości postępowania:</p>
<ul>
<li><p>Policzyć średnią dla każdej grupy, ignorując pozostałe grupy w tym procesie oraz fakt, że dokładność średnich będzie mniejsza dla mniej licznych grup (<em>no pooling</em>).</p></li>
<li><p>Policzyć średnią zmiennej <span class="math inline">\(X\)</span> , uznając, że lepiej jest skorzystać z najpewniejszej estymaty i zignorować podział na grupy (<em>full pooling</em>).</p></li>
<li><p>Użyć modelu mieszanego, który pozwoli nam wykorzystać wszystkie dostępne dane, poprzez wykorzystanie informacji z całej naszej próby (<em>partial pooling, borrowing information</em>).</p></li>
</ul>
<p>W jaki sposób model mieszany pozwoli nam na to? Dla uproszczenia zdefiniujmy model, w którym interesuje nas prawdopodobieństwo otrzymania średniej w próbie dla danej podgrupy <span class="math inline">\(\bar{x_j}\)</span>. Wiemy, że dla każdej średniej (sumy) niezależnych zmiennych losowych o takim samym rozkładzie, zgodnie z Centralnym Twierdzeniem Granicznym, rozkład średniej z próby dąży do rozkładu normalnego. Parametry tego rozkładu to prawdziwa średnia w grupie <span class="math inline">\(\theta_j\)</span> oraz odchylenie standardowe średnich w próbie <span class="math inline">\(\epsilon_j\)</span>. W związku z tym:</p>
<p><span class="math display">\[\bar{x_{i}} \sim N(\theta_j , \epsilon_j)\]</span>
Przypomnijmy sobie, że estymatorem odchylenia standardowego średnich, czyli błędu standardowego, jest <span class="math inline">\(\epsilon_j = \frac{\sigma_j}{\sqrt{n_j}}\)</span>, gdzie <span class="math inline">\(n_j\)</span> to liczebność danej grupy.</p>
<p>Jednocześnie, rozkład prawdziwych średnich w grupach jest dany rozkładem:</p>
<p><span class="math display">\[\theta_{j} \sim N(\mu, \tau)\]</span>
gdzie <span class="math inline">\(\mu\)</span> to ogólna średnia zmiennej <span class="math inline">\(X\)</span> , a <span class="math inline">\(\tau\)</span> to odchylenie standardowe rozkładu ogólnej średniej.</p>
<p>Dobrze, to co nas naprawdę interesuje, to policzenie najlepszej estymaty prawdziwej średniej w grupie <span class="math inline">\(\theta_j\)</span>. Do tego potrzebujemy rozkładu <span class="math inline">\(P(\theta_j|\bar{x_{i}})\)</span>. Aby obliczyć szukany przez nas rozkład, możemy zastosować twierdzenie Bayesa:</p>
<p><span class="math display">\[P(\theta_i|\bar{x_{i}}) \propto P(\bar{x_{i}}|\theta_i)P(\theta_i)\]</span></p>
<br>
<br>
<p class="comment">
<strong>Rozkład Normalny</strong>
<br>
<br>
Rozkład normalny dany jest wzorem:
<span class="math display">\[x \sim N(\mu,\sigma); \; \; P(x) = \frac{1}{\sigma\sqrt{2\pi}}
  \exp\left( -\frac{(x-\mu)^2}{2\sigma^2}\,\right)\]</span>
<br>
Gdzie <span class="math inline">\(\mu\)</span> i <span class="math inline">\(\sigma\)</span> to kolejno średnia i wariancja <span class="math inline">\(x\)</span>. Ponieważ w statystyce bayesowskiej często wystarczą nam relacje proporcjonalności możemy usnąć wszystko, co tylko skaluje nasz rozkład:
<br>
<span class="math display">\[P(x) \propto
  \exp\left( -\frac{(x-\mu)^2}{2\sigma^2}\,\right)\]</span>
</p>
<p><br></p>
<p>A więc nasz rozkład <em>post priori</em> będzie proporcjonalny do:</p>
<p><span class="math display">\[P(\theta_i|\bar{x_{i}}) \propto  \exp\left(-\frac{(\bar{x}_i - \theta_i)^2}{2\epsilon_i^2}\right)\exp\left(-\frac{(\theta_i-\mu)^2}{2\tau^2}\right)\]</span></p>
<p>Gdy po wykonaniu kilku przekształceń otrzymamy:</p>
<p><span class="math display">\[P(\theta_i|\bar{x_{i}}) \propto \exp\left(-\frac{(\theta_i - \hat{\theta_i})^2}{2S_i^2}\right)\]</span>
Rozkład normalny jest rozkładem zgodym (<em>conjugate prior</em>) dla samego siebie. A więc rozkład <em>a posteriori</em> jest rozkładem normalnym o średniej <span class="math inline">\(\hat{\theta_i}\)</span> i wariancji <span class="math inline">\(S^2\)</span>.</p>
<p>Gdzie</p>
<p><span class="math display">\[\hat{\theta_i} = \frac{\tau^2 \bar{x}_i + \epsilon_i^2\mu}{\tau^2 + \epsilon_i^2} = \left(\frac{\tau^2}{\tau^2 + \epsilon_i^2}\right)\bar{x}_i + \left(\frac{\epsilon_i^2}{\tau^2 + \epsilon_i^2}\right)\mu\]</span>
<span class="math display">\[\frac{1}{S_i^2} = \frac{1}{\tau^2} + \frac{1}{\epsilon_i^2}\]</span></p>
<p>Czyli nasz rozkład <em>posteriori</em> <span class="math inline">\(\theta_j\)</span> ma rozkład o średniej <span class="math inline">\(\hat{\theta}_{j}\)</span> i wariancji <span class="math inline">\(S^2\)</span>. Zwykle, jeśli chcemy otrzymać punktową estymatę parametru z rozkładu <em>posteriori</em>, bierzemy jego średnią (w przypadku rozkładu normalnego jego średnia ma najwyższą wartość gęstości prawdopodobieństwa). W tym przypadku będzie to <span class="math inline">\(\hat{\theta_i}\)</span>. Możemy zauważyć, że wzór na <span class="math inline">\(\hat{\theta_i}\)</span>, który otrzymaliśmy, to średnia ważona średniej w próbie w danej grupie <span class="math inline">\(x_i\)</span> i ogólnej średniej w próbie <span class="math inline">\(\mu\)</span>. Możemy zapisać to następująco:</p>
<p><span class="math display">\[\hat{\theta}_i = \lambda_i \bar{x}_i + (1-\lambda_i)\mu\]</span></p>
<p>gdzie:</p>
<p><span class="math display">\[\lambda_i = \frac{\tau^2}{(\tau^2 + \epsilon_i^2)}\]</span></p>
<p>Widzimy, że najlepsza estymata średniej w grupie będzie się różniła od średniej w próbie dla grupy <span class="math inline">\(j\)</span> w zależności od tego, jak bardzo <span class="math inline">\(\lambda_i\)</span> będzie mniejsze od 1. Będzie się tak działo, gdy <span class="math inline">\(\epsilon_j\)</span> będzie duży. A kiedy <span class="math inline">\(\epsilon_j\)</span> będzie duży? Przypomnijmy:</p>
<p><span class="math display">\[\epsilon_{j}^2 = \frac{\sigma_{j}^2}{n_j}\]</span></p>
<p>Zatem im mniejsza wariancja w danej grupie i im większa liczebność grupy, tym bardziej estymata średniej będzie się zbliżała do średniej empirycznej w grupie. Natomiast, jeśli wariancja w grupie jest duża i/lub grupa ma małą liczebność, estymata <span class="math inline">\(\hat{\theta}_i\)</span> będzie bardziej przesunięta w stronę <span class="math inline">\(\mu\)</span>, ponieważ prawdopodobieństwo, że średnia w grupie <span class="math inline">\(j\)</span> znacznie odbiega od średniej ogólnej, jest mniejsze (przypomnijmy sobie przykład z księgarnią z pierwszej części tutorialu).</p>
<p><span class="math inline">\(\lambda_i\)</span> nazywamy współcznynnikiem ściągania (<em>shrinkage coefficient</em>). Choć jego formuła nie będzie zawsze wyglądała tak elegancko, jak w tym przypdaku (gdzie rozkład <em>a priori</em> i funkcja wiarygodności dane są rozkładami normalnymi), widzimy, że model mieszany pozwala nam na estymację średnich w grupach z większą pewnością, ponieważ wykorzystujemy do tego obserwacje ze wszystkich podgrup!</p>
<p>Ta własność pozwala nam nie tylko na uzyskanie większej pewności naszych estymat, ale także na nie martwienie się problemem wielokrotnych porównań. Model w naturalny sposób przybliża średnie w grupach do średniej ogólnej gdy wariancja grup <span class="math inline">\(\tau^2\)</span> zbliża sie do 0. Nie będziemy omawiać tego dokładniej, ale Andrew Gelman opisał to w tym artykule <span class="citation" data-cites="gelman2012we">(<a href="#ref-gelman2012we" role="doc-biblioref">Gelman et al., 2012</a>)</span>, który wam polecam.</p>
<h2 id="modelujmy-dalej">Modelujmy dalej</h2>
<p>Zobaczmy teraz nieco bardziej skomplikowane przykłady modelu wielopoziomowego.</p>
<p>Radon jest radioaktywnym gazem szlachetnym, drugą po paleniu tytoniu, przyczyną raka płuc. Zanieczyszcza on wnętrza budynków przedostając się do środka przez małe szczeliny i otwory, stwarzając zagrożenie dla ludzi.</p>
<p>Mamy dane z 919 domów z 85 hrabstw, pomiar radonu w mieszkaniach oraz infromacje czy dom ma piwnicę (0) czy nie (1). Posiadamy także pomiar średnie stężenie uranu w glebie hrabstwa. Możecie je pobrać <span style="color:blue"><a href="https://github.com/Revan-tech/fuzzy-octo-waddle/tree/main/MBM%20Data">tutaj</a></span>. Zobaczmy je.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>data</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='st'>"Radon_Data.csv"</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>  county floor     radon    uranium
1      1     1 0.7884574 -0.6890476
2      1     0 0.7884574 -0.6890476
3      1     0 1.0647107 -0.6890476
4      1     0 0.0000000 -0.6890476
5      2     0 1.1314021 -0.8473129
6      2     0 0.9162907 -0.8473129</code></pre>
</div>
<h3 id="modelowanie-interceptu-i-wpspółczynnika-regresji-dla-klastra">Modelowanie interceptu i wpspółczynnika regresji dla klastra</h3>
<p>Radon uwalnia się z gleby, więc chcemy dowiedzieć się, jak posiadanie piwnicy wpływa na stężenie radonu. Nasz model będzie miał postać:</p>
<p><span class="math display">\[y_i = N(a_j + b_jx_i,\sigma)\]</span>
Indeks <span class="math inline">\(i\)</span> oznacza numer obserwacji, a indeks <span class="math inline">\(j\)</span> - numer hrabstwa. W naszym modelu uwzględniamy zarówno wyraz wolny (intercept), jak i współczynnik regresji dla danego hrabstwa. W ten sposób modelujemy korelacje pomiędzy obserwacjami w hrabstwach, które wynikają nie tylko z bazowego poziomu stężenia radonu w hrabstwie, ale także z różnic w poziomie stężenia radonu wynikających z posiadania piwnicy.</p>
<p>Warto zwrócić uwagę na fakt, że teraz każde hrabstwo ma swój własny intercept <span class="math inline">\(a_j\)</span> i współczynnik regresji <span class="math inline">\(b_j\)</span>. Prawdopodobnie istnieje pewna zależność między tymi parametrami. Na przykład w hrabstwach o wysokim bazowym poziomie radonu (<span class="math inline">\(a_j\)</span>) posiadanie piwnicy może mieć niewielki wpływ na poziom stężenia (<span class="math inline">\(b_j\)</span>), a w hrabstwach o niskim bazowym poziomie radonu posiadanie piwnicy może znacząco wpłynąć na poziom stężenia. Taka zależność również wpływa na korelacje obserwacji w grupach (hrabstwach), dlatego należy ją uwzględnić w modelu.</p>
<p>Jak to zrobić? Aby to zrozumieć, przyjrzyjmy się wielowymiarowemu rozkładowi normalnemu. Podobnie jak opisujemy rozkład zmiennej <span class="math inline">\(x\)</span> za pomocą rozkładu normalnego, tak możemy opisać łączny rozkład zmiennych <span class="math inline">\(x\)</span> i <span class="math inline">\(y\)</span> za pomocą wielowymiarowego rozkładu normalnego. Wielowymiarowy rozkład normalny jest opisany dwoma parametrami: wektorem średnich zmiennych <span class="math inline">\(\mu\)</span> oraz macierzą kowariancji <span class="math inline">\(\boldsymbol{\Sigma}\)</span>, która opisuje związki między zmiennymi. Jeśli dwie zmienne są niezależne, to odpowiednie elementy macierzy kowariancji są równe zero.”</p>
<br>
<p class="comment">
<strong>Wielowymiarowy Rozkład Normalny</strong>
<br>
<br>
Wielowymiarowy rozkład normalny opisuje sposób, w jaki zachowuje się <span class="math inline">\(m\)</span> zmiennych losowych, podobnie jak jednowymiarowy rozkład normalny opisuje sposób, w jaki zachowuje się jedna zmienna losowa. Jest on opisany przez wektor średnich <span class="math inline">\(\boldsymbol{\mu}\)</span> oraz macierz kowariancji <span class="math inline">\(\boldsymbol{\Sigma}\)</span>. Wielowymiarowy rozkład normalny oznaczamy symbolem <span class="math inline">\(\mathcal{N}_m(\boldsymbol{\mu}, \boldsymbol{\Sigma})\)</span>, gdzie <span class="math inline">\(m\)</span> określa wymiarowość przestrzeni, w której zmienne losowe mają swoje wartości.
<br>
<br>
Funkcja gęstości prawdopodobieństwa dla <span class="math inline">\(m\)</span>-wymiarowego rozkładu normalnego ma postać:
<span class="math display">\[f(\boldsymbol{x}) = \frac{1}{(2\pi)^{\frac{m}{2}}\sqrt{|\boldsymbol{\Sigma}|}} \exp\left(-\frac{1}{2}(\boldsymbol{x}-\boldsymbol{\mu})^T\boldsymbol{\Sigma}^{-1}(\boldsymbol{x}-\boldsymbol{\mu})\right)\]</span>
<br>
gdzie <span class="math inline">\(\boldsymbol{x}\)</span> jest <span class="math inline">\(m\)</span>-elementowym wektorem zmiennych losowych. Symbol <span class="math inline">\(|\boldsymbol{\Sigma}|\)</span> oznacza wartość wyznacznika macierzy <span class="math inline">\(\boldsymbol{\Sigma}\)</span>.
</p>
<p><br></p>
<p>A więc rokład <em>a priori</em> dla <span class="math inline">\(a_j\)</span>, <span class="math inline">\(b_j\)</span> będzie wyglądał tak:</p>
<p><span class="math display">\[ \begin{aligned}
\begin{pmatrix}a_j \\ b_j \end{pmatrix} &amp;\sim \mathcal{N_m}(\boldsymbol{\mu}, \boldsymbol{\Sigma}) \\
\end{aligned}\]</span></p>
<p>Gdzie</p>
<p><span class="math display">\[\boldsymbol{\mu} = \begin{pmatrix} \boldsymbol{\alpha} \\ \boldsymbol{\beta} \end{pmatrix}, \qquad \boldsymbol{\Sigma} = \begin{pmatrix} \mathrm{Var}(a_j) &amp; \mathrm{Cov}(a_j,b_j) \\ \mathrm{Cov}(a_j,b_j) &amp; \mathrm{Var}(b_j) \end{pmatrix}\]</span>
Oczywiście wszystkie parametry z powyższego wzoru mają swoje rozkłady <em>a priori</em> (możecie zobaczyć je w kodzie poniżej).</p>
<p>Nasz model w JAGS będzie wyglądał następująco:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>model</span> <span class='op'>=</span>  <span class='st'>"model {</span></span>
<span><span class='st'>#Likehood</span></span>
<span><span class='st'>for (i in 1:length(radon)){</span></span>
<span><span class='st'>radon[i] ~ dnorm(radon.hat[i], tau.y)</span></span>
<span><span class='st'>radon.hat[i] &lt;- a[county[i]]+ b[county[i]]*floor[i]</span></span>
<span><span class='st'>}</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Prior dla sigma</span></span>
<span><span class='st'>sigma.y ~ dunif (0, 1000)</span></span>
<span><span class='st'>tau.y &lt;- pow(sigma.y, -2)</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Prior dla alpha</span></span>
<span><span class='st'>alpha ~ dnorm (0, .0001)</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Prior dla beta</span></span>
<span><span class='st'>beta ~ dnorm (0, .0001)</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Priory dla a_j i b_j</span></span>
<span><span class='st'>for (j in 1:max(county)){</span></span>
<span><span class='st'>mu[j,1] &lt;- alpha </span></span>
<span><span class='st'>mu[j,2] &lt;- beta </span></span>
<span><span class='st'>g[j,1:2] ~ dmnorm(mu[j,1:2],tau.g[1:2,1:2])</span></span>
<span><span class='st'>a[j] &lt;- g[j,1]</span></span>
<span><span class='st'>b[j] &lt;- g[j,2]</span></span>
<span><span class='st'>}</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Prior dla wariancji a_j</span></span>
<span><span class='st'>sigma.a ~ dunif (0, 100)</span></span>
<span><span class='st'>sigma.g[1,1] &lt;- pow(sigma.a, 2)</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Prior dla wariancji b_j</span></span>
<span><span class='st'>sigma.g[2,2] &lt;- pow(sigma.b, 2)</span></span>
<span><span class='st'>sigma.b ~ dunif (0, 100)</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Prior dla wspóczynnika korelacji a_j i b_j</span></span>
<span><span class='st'>rho ~ dunif (-1, 1)</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Kowariancja a_j i b_j</span></span>
<span><span class='st'>sigma.g[1,2] &lt;- rho*sigma.a*sigma.b</span></span>
<span><span class='st'>sigma.g[2,1] &lt;- sigma.g[1,2]</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Zamiana na macierz precyzji</span></span>
<span><span class='st'>tau.g[1:2,1:2] &lt;- inverse(sigma.g[,])</span></span>
<span><span class='st'>}"</span></span></code></pre>
</div>
</div>
<p>“O ile nie interesuje nas relacja między piętrem a radonem w konkretnym hrabstwie, możemy śledzić jedynie wektor <span class="math inline">\(\boldsymbol{\mu}\)</span> zawierający ogólny intercept (<span class="math inline">\(\alpha\)</span>) i współczynnik regresji <span class="math inline">\(\beta\)</span>. Wyestymujmy także <span class="math inline">\(\rho\)</span>, czyli nasz współczynnik korelacji pomiędzy <span class="math inline">\(a_j\)</span> i <span class="math inline">\(b_j\)</span>.”</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>params</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"alpha"</span>,<span class='st'>"beta"</span>, <span class='st'>"rho"</span><span class='op'>)</span></span>
<span><span class='va'>n.adapt</span> <span class='op'>=</span> <span class='fl'>100</span></span>
<span><span class='va'>ni</span> <span class='op'>=</span> <span class='fl'>3000</span></span>
<span><span class='va'>nb</span> <span class='op'>=</span> <span class='fl'>6000</span></span>
<span><span class='va'>nt</span> <span class='op'>=</span> <span class='fl'>1</span></span>
<span><span class='va'>nc</span> <span class='op'>=</span> <span class='fl'>4</span></span>
<span><span class='va'>jmod</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/rjags/man/jags.model.html'>jags.model</a></span><span class='op'>(</span>file <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/textconnections.html'>textConnection</a></span><span class='op'>(</span><span class='va'>model</span><span class='op'>)</span>, data <span class='op'>=</span> <span class='va'>data</span>, n.chains <span class='op'>=</span> <span class='va'>nc</span>, inits <span class='op'>=</span> <span class='cn'>NULL</span>, n.adapt <span class='op'>=</span> <span class='va'>n.adapt</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span><span class='op'>(</span><span class='va'>jmod</span>, n.iter<span class='op'>=</span><span class='va'>ni</span>, by<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span></span>
<span><span class='va'>post</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/rjags/man/coda.samples.html'>coda.samples</a></span><span class='op'>(</span><span class='va'>jmod</span>, <span class='va'>params</span>, n.iter <span class='op'>=</span> <span class='va'>nb</span>, thin <span class='op'>=</span> <span class='va'>nt</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>post</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>
Iterations = 3101:9100
Thinning interval = 1 
Number of chains = 4 
Sample size per chain = 6000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

         Mean      SD  Naive SE Time-series SE
alpha  1.4613 0.05387 0.0003477      0.0007756
beta  -0.6840 0.08640 0.0005577      0.0025487
rho   -0.2802 0.32702 0.0021109      0.0131739

2. Quantiles for each variable:

         2.5%     25%     50%      75%   97.5%
alpha  1.3572  1.4250  1.4610  1.49680  1.5691
beta  -0.8515 -0.7408 -0.6866 -0.63047 -0.5057
rho   -0.8603 -0.5099 -0.3061 -0.07353  0.4388</code></pre>
</div>
<p>Tak jak się spodziewaliśmy, im większy indywidualny intercept, tym mniejszy współczynnik regresji dla posiadania piwnicy. Taki model, który właśnie stworzyliśmy, jest konceptualnym odpowiednikiem modelu z random interceptem i random współczynnikiem w statystyce częstościowej.</p>
<h3 id="predyktory-na-wyższych-poziomach">Predyktory na wyższych poziomach</h3>
<p>Zauważmy, że w danych mamy jeszcze informacje o średnim stężeniu uranu w glebie w danym hrabstwie. Radon powstaje w wyniku rozpadu uranu, więc jest to istotny predyktor stężenia radonu w mieszkaniu. Jednakże, posiadamy tylko dane dotyczące hrabstwa, a nie mieszkania, co wymaga od nas zamodelowania związku na poziomie klastra. Jak będzie wyglądał nasz model? Funkcja wiarygodności pozostaje taka sama:</p>
<p><span class="math display">\[y_i = N(a_j + b_jx_i,\sigma)\]</span></p>
<p>ale nasz rozkład <em>a priori</em> <span class="math inline">\(a_j\)</span> i <span class="math inline">\(b_j\)</span> będzie wyglądał tak:</p>
<p><span class="math display">\[ \begin{aligned}
\begin{pmatrix}a_j \\ b_j \end{pmatrix} &amp;\sim \mathcal{N_m}(\begin{pmatrix} \boldsymbol{\alpha + \lambda u_j} \\ \boldsymbol{\beta} \end{pmatrix} \begin{pmatrix} \mathrm{Var}(a_j) &amp; \mathrm{Cov}(a_j,b_j) \\ \mathrm{Cov}(a_j,b_j) &amp; \mathrm{Var}(b_j) \end{pmatrix}) \\
\end{aligned}\]</span></p>
<p>Jak możemy zauważyć, intercept dla danego hrabstwa jest teraz modelowany jako zmienna losowa z rozkładu o średniej <span class="math inline">\(\alpha + \lambda u_j\)</span>. Widzimy też dosyć wyraźnie, że modelujemy relację pomiędzy stężeniem radonu a średnim stężeniem uranu na innym poziomie niż relację zmienną oznaczającą posiadanie piwnicy. Jeśli nazwiemy predyktorem dla pierwszego poziomu zmienną floor, to znaczy zmienną na poziomie każdej obserwacji (mieszkania), to średnie stężenie uranu wpływa tak samo na każde mieszkanie w hrabstwie, a więc jest predyktorem drugiego poziomu, to znaczy predyktorem interceptu dla klastra.</p>
<p>Możemy dopełnić skomplikowanie modelu w następujący sposób.</p>
<p><span class="math display">\[ \begin{aligned}
\begin{pmatrix}a_j \\ b_j \end{pmatrix} &amp;\sim \mathcal{N_m}(\begin{pmatrix} \boldsymbol{\alpha + \lambda u_j} \\ \boldsymbol{\beta + \gamma u_j} \end{pmatrix} \begin{pmatrix} \mathrm{Var}(a_j) &amp; \mathrm{Cov}(a_j,b_j) \\ \mathrm{Cov}(a_j,b_j) &amp; \mathrm{Var}(b_j) \end{pmatrix}) \\
\end{aligned}\]</span></p>
<p>Czym w takim wypadku będzie <span class="math inline">\(\gamma\)</span>? Będzie nam mówił jak zmienia się współczynnik dla piętra w zależności od średniego poziomu uranu w hrabstwie. Innymi słowy będzie współczynnikiem dla interakcji dla predyktora pierwszego poziomu - piętra i predyktora drugieo poziomu - uranu.</p>
<p>Zaimplementujmy taki model.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>model</span> <span class='op'>=</span>  <span class='st'>"model {</span></span>
<span><span class='st'>#Likehood</span></span>
<span><span class='st'>for (i in 1:length(radon)){</span></span>
<span><span class='st'>radon[i] ~ dnorm(radon.hat[i], tau.y)</span></span>
<span><span class='st'>radon.hat[i] &lt;- a[county[i]]+ b[county[i]]*floor[i]</span></span>
<span><span class='st'>}</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Prior dla sigma</span></span>
<span><span class='st'>sigma.y ~ dunif (0, 1000)</span></span>
<span><span class='st'>tau.y &lt;- pow(sigma.y, -2)</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Prior dla alpha</span></span>
<span><span class='st'>alpha ~ dnorm (0, .0001)</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Prior dla beta</span></span>
<span><span class='st'>beta ~ dnorm (0, .0001)</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Prior dla lambda</span></span>
<span><span class='st'>lambda ~ dnorm (0, .0001)</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Prior dla gamma</span></span>
<span><span class='st'>gamma ~ dnorm (0, .0001)</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Priory dla a_j i b_j</span></span>
<span><span class='st'>for (j in 1:max(county)){</span></span>
<span><span class='st'>mu[j,1] &lt;- alpha + lambda*uranium[j]</span></span>
<span><span class='st'>mu[j,2] &lt;- beta + gamma*uranium[j]</span></span>
<span><span class='st'>g[j,1:2] ~ dmnorm(mu[j,1:2],tau.g[1:2,1:2])</span></span>
<span><span class='st'>a[j] &lt;- g[j,1]</span></span>
<span><span class='st'>b[j] &lt;- g[j,2]</span></span>
<span><span class='st'>}</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Prior dla wariancji a_j</span></span>
<span><span class='st'>sigma.a ~ dunif (0, 100)</span></span>
<span><span class='st'>sigma.g[1,1] &lt;- pow(sigma.a, 2)</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Prior dla wariancji b_j</span></span>
<span><span class='st'>sigma.g[2,2] &lt;- pow(sigma.b, 2)</span></span>
<span><span class='st'>sigma.b ~ dunif (0, 100)</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Prior dla wspóczynnika korelacji a_j i b_j</span></span>
<span><span class='st'>rho ~ dunif (-1, 1)</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Kowariancja a_j i b_j</span></span>
<span><span class='st'>sigma.g[1,2] &lt;- rho*sigma.a*sigma.b</span></span>
<span><span class='st'>sigma.g[2,1] &lt;- sigma.g[1,2]</span></span>
<span><span class='st'></span></span>
<span><span class='st'>#Zamiana na macierz precyzji</span></span>
<span><span class='st'>tau.g[1:2,1:2] &lt;- inverse(sigma.g[,])</span></span>
<span><span class='st'>}"</span></span></code></pre>
</div>
</div>
<p>By użyć tego modelu musimy wyciągnąć uranium z naszych danych i stworzyć z niego wektor tylu wartości, ile jest hrabstw.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>uranium</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>data</span> <span class='op'>%&gt;%</span> <span class='fu'>select</span><span class='op'>(</span><span class='va'>county</span>,<span class='va'>uranium</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>county</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>select</span><span class='op'>(</span><span class='va'>uranium</span><span class='op'>)</span></span>
<span><span class='va'>data</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>as.list</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span></span>
<span><span class='va'>data</span><span class='op'>[[</span><span class='fl'>4</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>=</span> <span class='va'>uranium</span><span class='op'>$</span><span class='va'>uranium</span></span></code></pre>
</div>
</div>
<p>Zaimplementujmy model</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>params</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"alpha"</span>,<span class='st'>"beta"</span>, <span class='st'>"rho"</span>, <span class='st'>"lambda"</span>,<span class='st'>"gamma"</span><span class='op'>)</span></span>
<span><span class='va'>n.adapt</span> <span class='op'>=</span> <span class='fl'>100</span></span>
<span><span class='va'>ni</span> <span class='op'>=</span> <span class='fl'>3000</span></span>
<span><span class='va'>nb</span> <span class='op'>=</span> <span class='fl'>6000</span></span>
<span><span class='va'>nt</span> <span class='op'>=</span> <span class='fl'>1</span></span>
<span><span class='va'>nc</span> <span class='op'>=</span> <span class='fl'>4</span></span>
<span><span class='va'>jmod</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/rjags/man/jags.model.html'>jags.model</a></span><span class='op'>(</span>file <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/textconnections.html'>textConnection</a></span><span class='op'>(</span><span class='va'>model</span><span class='op'>)</span>, data <span class='op'>=</span> <span class='va'>data</span>, n.chains <span class='op'>=</span> <span class='va'>nc</span>, inits <span class='op'>=</span> <span class='cn'>NULL</span>, n.adapt <span class='op'>=</span> <span class='va'>n.adapt</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span><span class='op'>(</span><span class='va'>jmod</span>, n.iter<span class='op'>=</span><span class='va'>ni</span>, by<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span></span>
<span><span class='va'>post</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/rjags/man/coda.samples.html'>coda.samples</a></span><span class='op'>(</span><span class='va'>jmod</span>, <span class='va'>params</span>, n.iter <span class='op'>=</span> <span class='va'>nb</span>, thin <span class='op'>=</span> <span class='va'>nt</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>post</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>
Iterations = 3101:9100
Thinning interval = 1 
Number of chains = 4 
Sample size per chain = 6000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

          Mean      SD  Naive SE Time-series SE
alpha   1.4602 0.03986 0.0002573       0.002138
beta   -0.6623 0.09091 0.0005868       0.003846
gamma  -0.4087 0.23621 0.0015247       0.007880
lambda  0.8036 0.09346 0.0006033       0.002801
rho     0.2043 0.46022 0.0029707       0.026619

2. Quantiles for each variable:

          2.5%     25%     50%     75%    97.5%
alpha   1.3837  1.4341  1.4604  1.4877  1.53710
beta   -0.8389 -0.7237 -0.6612 -0.6020 -0.48133
gamma  -0.8700 -0.5636 -0.4126 -0.2495  0.05927
lambda  0.6169  0.7454  0.8035  0.8639  0.98921
rho    -0.7210 -0.1360  0.2425  0.5833  0.93936</code></pre>
</div>
<p>Podsumujmy, co dowiedzieliśmy się z tego modelu. Średnia beta jest ujemna, co oznacza, że jeśli dom nie posiada piwnicy, to średnie stężenie radonu jest mniejsze. Średnia lambda jest dodatnia, co sugeruje, że im wyższy średni poziom radonu w danym hrabstwie, tym wyższe stężenie radonu w mieszkaniu w tym hrabstwie.</p>
<p>Jednak średnia gamma jest ujemna, co oznacza, że im wyższe stężenie uranu w danym hrabstwie, tym mniejsze stężenie radonu w domach bez piwnicy. To wydaje się być nieco dziwne, ale warto zwrócić uwagę na przedział wiarygodności. Dla gamma 95% przedział wiarygodności zawiera 0, co sugeruje, że ta estymata może nie być zbyt wiarygodna.</p>
<h2 id="podsumowanie">Podsumowanie</h2>
<p>Zobaczyliśmy, jak tworzy się modele hierarchiczne w podejściu bayesowskim. Niemniej jednak, ponieważ ten post skupiał się tylko na wybranych aspektach, możliwe, że pozostajecie z niedosytem. W takim przypadku polecam książkę Gelmana i Hill o modelach hierarchicznych, w której w sposób systematyczny pokazują, jak modelować dane wielopoziomowe <span class="citation" data-cites="gelman2006data">(<a href="#ref-gelman2006data" role="doc-biblioref">Gelman &amp; Hill, 2006</a>)</span>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="doc-bibliography">
<div id="ref-gelman2006data" class="csl-entry" role="doc-biblioentry">
Gelman, A., &amp; Hill, J. (2006). <em>Data analysis using regression and multilevel/hierarchical models</em>. Cambridge university press.
</div>
<div id="ref-gelman2012we" class="csl-entry" role="doc-biblioentry">
Gelman, A., Hill, J., &amp; Yajima, M. (2012). Why we (usually) don’t have to worry about multiple comparisons. <em>Journal of Research on Educational Effectiveness</em>, <em>5</em>(2), 189–211.
</div>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>© Copyright 2023 Sortownia</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
